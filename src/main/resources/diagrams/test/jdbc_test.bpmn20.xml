<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/pur">
  <process id="jdbcTest" name="JDBC Test " isExecutable="true" activiti:candidateStarterGroups="admin">
    <startEvent id="startevent1" name="Start">
    	<extensionElements>
    		<activiti:executionListener event="end" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
    			<activiti:field name="language">
    				<activiti:string>
    					<![CDATA[groovy]]>
    				</activiti:string>
    			</activiti:field>
    			<activiti:field name="script">
    				<activiti:string>
    					<![CDATA[import groovy.json.JsonOutput
							import groovy.json.JsonSlurper
							import com.eorionsolution.bpms.extension.jdbc.JdbcUtils
							
							def jsonSlurper = new JsonSlurper()
    						def jsonString = """
{
  "tableName":"PRODUCTION_PROCESS",
  "type":0,
  "details":
  [
    {
      "insert":{"SUP_PROC_INST_":"99999","CODE_":"TT1"}
    },
    {
      "insert": {"SUP_PROC_INST_":"99999","CODE_":"TT2"}
    }
  ]

} 						
"""    					
							def json = JsonOutput.toJson(jsonSlurper.parseText(jsonString))
							def handleResult = JdbcUtils.batchInsert(json)
							if (handleResult != 200) {
								throw new Exception("insert error...")
							}
    					]]>
    				</activiti:string>
    			</activiti:field>
    		</activiti:executionListener>
    	</extensionElements>
    </startEvent>
    <endEvent id="endevent1" name="End"></endEvent>
    <sequenceFlow id="flow1" sourceRef="startevent1" targetRef="endevent1"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_jdbcTest">
    <bpmndi:BPMNPlane bpmnElement="jdbcTest" id="BPMNPlane_jdbcTest">
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="240.0" y="170.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="450.0" y="170.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="275.0" y="187.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="187.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>