<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="getVariables" name="跨流程实例获取变量测试" isExecutable="true" activiti:candidateStarterGroups="admin">
    <startEvent id="startevent1" name="Start" activiti:initiator="initiator">
    	<extensionElements>
    		<activiti:executionListener event="start" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
    			<activiti:field name="language">
    				<activiti:string><![CDATA[groovy]]></activiti:string>
    			</activiti:field>
    			<activiti:field name="script">
    				<activiti:string>
    				<![CDATA[
						def otherExecution = runtimeService.createExecutionQuery().processInstanceId("302930").singleResult()
						if(otherExecution == null) {
							throw new org.activiti.engine.ActivitiIllegalArgumentException('工艺流程已结束')
						}
						def variable = otherExecution.getVariable('header1567132194059')
    					if(variable) {
    						execution.setVariable('header1567132194059', variable)
    					} else {
    						throw new org.activiti.engine.ActivitiIllegalArgumentException('流程实例对应的数据未找到')
    					}
    					
    					
    					
    				]]>
    				</activiti:string>
    			</activiti:field>
    		</activiti:executionListener>
    	</extensionElements>
    </startEvent>
    <userTask id="usertask1" name="User Task"  activiti:assignee="${initiator}">
    	<extensionElements>
    	<activiti:formProperty id="tbheader1567132194059_item" name="工序表" type="string" variable="header1567132194059" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_subprocessname_工序名称_2_string_t1_$$A" name="工序名称" type="string" variable="subprocessname" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_sectionnumber_工段编号_3_string_t1_$$HA" name="工段编号" type="string" variable="sectionnumber" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_plannedstarttime_计划开始时间_4_string_t5_$$HA" name="计划开始时间" type="string" variable="plannedstarttime" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_plannedendtime_计划结束时间_5_string_t5_$$HA" name="计划结束时间" type="string" variable="plannedendtime" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_subprocessnumber_工序编号_6_string_t1_$$A" name="工序编号" type="string" variable="subprocessnumber" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_subprocesstype_工序类型_7_enum_sbs_$$A" name="工序类型" type="enum" variable="subprocesstype" writable="true" required="false">
          <activiti:value id="1" name="通用" />
          <activiti:value id="2" name="铣削" />
          <activiti:value id="3" name="车削" />
        </activiti:formProperty>
        <activiti:formProperty id="tbheader1567132194059_header1567132289139_工序物料表_8_string_join_$$A" name="工序物料表" type="string" variable="join1567132465835" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_header1567132324213_通用工步表_9_string_join_$$A" name="通用工步表" type="string" variable="join1567132465835" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_header1567132326069_车削工步表_10_string_join_$$A" name="车削工步表" type="string" variable="join1567132465835" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059_header1567132326535_铣削工步表_11_string_join_$$A" name="铣削工步表" type="string" variable="join1567132465835" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132289139_item" name="工序物料表" type="string" variable="header1567132289139" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132289139_materialnumber2_物料编号_2_string_t1_$$A" name="物料编号" type="string" variable="materialnumber2" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132289139_join-key_Key_10_string_t1_$$A" name="Key" type="string" variable="" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132324213_item" name="通用工步表" type="string" variable="header1567132324213" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132324213_commonstep_通用工步_2_string_t1_$$A" name="通用工步" type="string" variable="commonstep" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132324213_join-key_Key_10_string_t1_$$A" name="Key" type="string" variable="" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132326069_item" name="车削工步表" type="string" variable="header1567132326069" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132326069_turnningstep_车削工步_2_string_t1_$$A" name="车削工步" type="string" variable="turnningstep" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132326069_join-key_Key_10_string_t1_$$A" name="Key" type="string" variable="" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132326535_item" name="铣削工步表" type="string" variable="header1567132326535" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132326535_millingstep_铣削工步_2_string_t1_$$A" name="铣削工步" type="string" variable="millingstep" writable="true" required="false" />
        <activiti:formProperty id="tbheader1567132194059-header1567132326535_join-key_Key_10_string_t1_$$A" name="Key" type="string" variable="" writable="true" required="false" />
        
    	</extensionElements>
    </userTask>
    <sequenceFlow id="flow1" sourceRef="startevent1" targetRef="usertask1"></sequenceFlow>
    <endEvent id="endevent1" name="End"></endEvent>
    <sequenceFlow id="flow2" sourceRef="usertask1" targetRef="endevent1"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_getVariables">
    <bpmndi:BPMNPlane bpmnElement="getVariables" id="BPMNPlane_getVariables">
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="120.0" y="200.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask1" id="BPMNShape_usertask1">
        <omgdc:Bounds height="55.0" width="105.0" x="240.0" y="190.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="390.0" y="200.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="155.0" y="217.0"></omgdi:waypoint>
        <omgdi:waypoint x="240.0" y="217.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="345.0" y="217.0"></omgdi:waypoint>
        <omgdi:waypoint x="390.0" y="217.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>